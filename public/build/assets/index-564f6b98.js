var we=Object.defineProperty;var ye=(o,s,d)=>s in o?we(o,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[s]=d;var X=(o,s,d)=>(ye(o,typeof s!="symbol"?s+"":s,d),d);import{_ as j,b as Z,c as xe,d as ke}from"./CardBoxModal-baf6546f.js";import{A as Ce,_ as Be,a as Ee}from"./SectionMain-294f5b0a.js";import{a2 as D,a3 as Se,r as i,u as te,x as Pe,B as Ae,N as Ne,w as Ue,a5 as Ve,a6 as I,a7 as $e,l as Y,o as m,c as h,E as c,z as w,b as n,a1 as ee,a0 as F,a as t,t as _,q as E,s as U,L as z,F as R,d as G,G as le,e as Me,J as De,m as Te,a9 as Ie,$ as Fe,aa as ze}from"./app-c03dcb6d.js";import{m as Re,a as qe,b as He,d as Le,f as je}from"./mdi-4b5bd968.js";import{_ as Ge}from"./BaseIcon-398b9207.js";class Ze{constructor(){X(this,"apiUrl","/users")}create(s,d,u){return D.post(this.apiUrl,{email:s,username:d,password:u})}getList(){return D.get(this.apiUrl+"/")}edit(s,d,u,f){return D.put(this.apiUrl+"/"+s,{newUsername:d,oldPassword:u,password:f})}async updateUser(s,d,u,f){return(await D.put(this.apiUrl+"/"+s,{newUsername:d,oldPassword:u,password:f})).data}delete(s){return D.delete(this.apiUrl+"/"+s)}}const q=new Ze,ae=Se("user",{state:()=>({orderedServices:[],selectedService:null,serviceSelected:!1,services:[],fetchError:null,loading:!1}),actions:{clear(){this.orderedServices=[],this.selectedService=null,this.loading=!1},setSelectedService(o){console.log("SelectedUser",o),o?(this.selectedService=o,this.serviceSelected=!0):this.serviceSelected=!1},fetch(){this.loading=!0,q.getList().then(o=>{this.services=o.data}).catch(o=>{this.fetchError=o}).finally(()=>{this.loading=!1})},async create(o,s,d){this.loading=!0;try{const u=await q.create(o,s,d);return u.data.user&&this.services.push(u.data.user),u.data}catch(u){return this.fetchError=u,u}finally{this.loading=!1}},async edit(o,s,d,u){console.log("eeew",this.services,o,s,d,u),this.loading=!0;try{const f=await q.edit(o,s,d,u);if(f.data.success){const r=this.services.findIndex(S=>S.id===o);this.services[r]=f.data.user}return f.data}catch(f){return this.fetchError=f,f}finally{this.loading=!1}},async delete(o){this.loading=!0;try{return await q.delete(o),this.services=this.services.filter(s=>s.id!==o),!0}catch(s){return this.fetchError=s,s}finally{this.loading=!1}}}}),Je={key:0},Oe={class:"text-red-500 text-sm"},Ke={key:1},Qe={class:"text-green-400 text-sm"},We={class:"flex items-center h-10 bg-white rounded-lg border pr-4 mb-5 mt-10"},Xe={class:"relative text-gray-600 search-bar mx-3 flex w-full"},Ye=["placeholder"],el=["src"],ll={class:"flex items-center h-10 bg-white rounded-lg border pr-4 mb-5 mt-3"},al={class:"relative text-gray-600 search-bar mx-3 flex w-full"},tl=["placeholder"],sl=["src"],ol={class:"flex items-center h-10 bg-white rounded-lg border pr-4 mb-5 mt-3"},nl={class:"relative text-gray-600 search-bar mx-3 flex w-full"},rl=["placeholder"],ul=["src"],il={class:"flex items-center h-10 bg-white rounded-lg border pr-4 mb-5 mt-3"},dl={class:"relative text-gray-600 search-bar mx-3 flex w-full"},cl=["placeholder"],ml=["src"],vl={key:0},hl={class:"text-red-500 text-sm"},fl={key:1},gl={class:"text-green-400 text-sm"},pl=t("p",null,"Are you sure?",-1),bl={key:0,class:"p-3 bg-gray-100/50 dark:bg-slate-800"},_l={key:1},wl=["onClick"],yl={key:0},xl={colspan:"6"},kl={class:"w-full flex justify-center"},Cl={class:"before:hidden whitespace-nowrap"},Bl={"data-label":"Created",class:"whitespace-nowrap"},El={class:"text-gray-500 dark:text-slate-400"},Sl={"data-label":"Email"},Pl={"data-label":"Name"},Al={"data-label":"PieceId"},Nl={key:2,class:"flex justify-center"},Ul={__name:"TableDataClient",props:{checkable:Boolean,setModalActive:{type:Boolean,default:!1}},emits:{},setup(o,{expose:s,emit:d}){const u=i(!1);s({showNewModal:()=>{document.getElementById("NewForm").reset(),u.value=!0}});const{t:r}=te(),S=i(!1),k=ae(),{services:se,selectedService:T,loading:oe}=Pe(ae()),H=i(!1),L=i(5),V=i(1),$=i([]);i(!1);const P=i(!1),C=i(""),p=i(""),A=i("");i("");const B=i(""),y=i(""),v=i(""),b=i(""),N=i(!1),g=i(null),x=i(null);Ae(()=>{k.fetch()}),Ne(()=>{k.clear()});const J=i([{label:r("users.table.actions"),id:"actions"},{label:r("users.table.date"),id:"createdAt"},{label:r("users.table.email"),id:"email"},{label:r("users.table.username"),id:"username"},{label:r("users.table.Number"),id:"id"}]);Ue(()=>{J.value.forEach(e=>{switch(e.id){case"actions":e.label=r("users.table.actions");break;case"createdAt":e.label=r("users.table.date");break;case"email":e.label=r("users.table.email");break;case"username":e.label=r("users.table.username");break;case"id":e.label=r("users.table.Number");break}})});const O=Ve().shape({email:I().matches(/^[A-Z0-9._%+-]+@gmail\.com$/i,"Email must be @gmail.com").required(),username:I().min(6).required(),password:I().min(8).required(),password_confirmation:I().required().oneOf([$e("password")],"Passwords do not match")}),K=Y(()=>{const e=se.value.map(a=>({createdAt:a.created_at,username:a.username,email:a.email,id:a.id}));return e.sort((a,l)=>a[C.value]>l[C.value]?P.value?1:-1:a[C.value]<l[C.value]?P.value?-1:1:0),e}),ne=Y(()=>K.value.slice(L.value*(V.value-1),L.value*V.value)),re=(e,a)=>{const l=[];return e.forEach(M=>{a(M)||l.push(M)}),l},ue=(e,a)=>{e?$.value.push(a):$.value=re($.value,l=>l.id===a.id)},ie=e=>{C.value===e?P.value=!P.value:(P.value=!0,e!="actions"&&(C.value=e))},de=e=>{console.log(e),V.value=e.pageNumber,L.value=e.pageSize},ce=e=>{document.getElementById("EditForm").reset(),console.log("kk",e.email,e,"service.name",e.name,"selectedService.value.username",e.username),k.setSelectedService(e),B.value="",v.value="",b.value="",A.value=e.username,S.value=!0},me=e=>{k.setSelectedService(e),H.value=!0},ve=e=>{p.value=e.target.value},he=e=>{y.value=e.target.value},fe=e=>{v.value=e.target.value},ge=e=>{b.value=e.target.value},Q=e=>/^[a-zA-Z0-9._%+-]+@gmail\.com$/.test(e),pe=()=>{console.log("verifyEmail",Q("example@gmail.com")),N.value=!0,console.log("newTitile",p.value,y.value),v.value==b.value&&(p.value!=""&&Q(p.value)||p.value=="")&&k.create(p.value,y.value,v.value).then(e=>{e.error?(console.log("errorExcution",e.error,e),N.value=!1,g.value=e.error,document.getElementById("NewForm").reset(),setTimeout(()=>{g.value=null,p.value="",y.value="",v.value=""},500)):e.success&&(p.value="",y.value="",v.value="",document.getElementById("NewForm").reset(),N.value=!1,x.value=e.message,setTimeout(()=>{x.value=null,u.value=!1},500))}).catch(e=>{p.value="",y.value="",v.value="",N.value=!1}).finally(()=>{p.value="",y.value="",v.value="",N.value=!1})},be=()=>{g.value=null,console.log("ID",T.value.username,T.value.id,A.value,"Passwords",B.value,v.value,b.value),v.value.length>7&&b.value.length>7?v.value==b.value?k.edit(T.value.id,A.value,B.value,v.value).then(e=>{console.log("res",e),e.error?(console.log("errorExcution",e.error,e),g.value=e.error,setTimeout(()=>{g.value=null},500)):e.success&&(B.value="",A.value="",v.value="",b.value="",x.value=e.message,setTimeout(()=>{x.value=null,S.value=!1},500))}).catch(e=>{console.log("err",e)}).finally(()=>{B.value="",v.value="",b.value=""}):(g.value="Passwords do not match",setTimeout(()=>{g.value=null},500)):(g.value="Password must be at least 8 characters",setTimeout(()=>{g.value=null},500))},_e=()=>{k.delete(T.value.id).then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{})};return(e,a)=>(m(),h(R,null,[c(j,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value=l),title:"Creat a new user","button-label":n(r)("common.save"),button:"bg-main","has-cancel":"",onConfirm:pe,showModal:!0},{default:w(()=>[c(n(ee),{"validation-schema":n(O),id:"NewForm"},{default:w(()=>[c(F,{"input-type":"email",name:"email",onInput:ve,value:p.value,"icon-src":"/images/login/email_grey.svg",placeholder:n(r)("auth.login.email"),class:"w-full mb-6 font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),c(F,{"input-type":"text",name:"username",onInput:he,value:y.value,"icon-src":"/images/home/placeholder_user.svg",placeholder:n(r)("auth.login.username"),class:"w-full mb-6 font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),c(F,{"input-type":"password",name:"password",onInput:fe,value:v.value,"icon-src":"/images/login/password_grey.svg",placeholder:n(r)("auth.login.password"),class:"w-full font-readex text-base font-light mb-6"},null,8,["value","icon-src","placeholder"]),c(F,{"input-type":"password",name:"password_confirmation",onInput:ge,value:b.value,"icon-src":"/images/login/password_grey.svg",placeholder:n(r)("auth.signup.confirmPassword"),class:"w-full font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),g.value?(m(),h("div",Je,[t("p",Oe,_(g.value),1)])):E("",!0),x.value?(m(),h("div",Ke,[t("p",Qe,_(x.value),1)])):E("",!0)]),_:1},8,["validation-schema"])]),_:1},8,["modelValue","button-label"]),c(j,{modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=l=>S.value=l),title:n(r)("users.modal.edit.title"),button:"bg-main","button-label":n(r)("common.update"),"has-cancel":"",onConfirm:be,showModal:!0},{default:w(()=>[c(n(ee),{"validation-schema":n(O),id:"EditForm"},{default:w(()=>[t("div",We,[t("div",Xe,[U(t("input",{class:"text-sm border-none focus:outline-none text-right w-full pr-0",type:"text",placeholder:n(r)("account.username"),"onUpdate:modelValue":a[1]||(a[1]=l=>A.value=l),onBlur:a[2]||(a[2]=(...l)=>e.handleBlur&&e.handleBlur(...l))},null,40,Ye),[[z,A.value]])]),t("div",null,[t("img",{src:"/images/home/placeholder_user.svg"},null,8,el)])]),t("div",ll,[t("div",al,[U(t("input",{class:"text-sm border-none focus:outline-none text-right w-full pr-0",type:"password",name:"oldPassword",placeholder:n(r)("account.oldPassword"),"onUpdate:modelValue":a[3]||(a[3]=l=>B.value=l),onBlur:a[4]||(a[4]=(...l)=>e.handleBlur&&e.handleBlur(...l))},null,40,tl),[[z,B.value]])]),t("div",null,[t("img",{src:"/images/login/password_grey.svg"},null,8,sl)])]),t("div",ol,[t("div",nl,[U(t("input",{class:"text-sm border-none focus:outline-none text-right w-full pr-0",type:"password",name:"password",placeholder:n(r)("account.newPassword"),"onUpdate:modelValue":a[5]||(a[5]=l=>v.value=l),onBlur:a[6]||(a[6]=(...l)=>e.handleBlur&&e.handleBlur(...l))},null,40,rl),[[z,v.value]])]),t("div",null,[t("img",{src:"/images/login/password_grey.svg"},null,8,ul)])]),t("div",il,[t("div",dl,[U(t("input",{class:"text-sm border-none focus:outline-none text-right w-full pr-0",type:"password",name:"password_confirmation",placeholder:n(r)("account.confirmPassword"),"onUpdate:modelValue":a[7]||(a[7]=l=>b.value=l),onBlur:a[8]||(a[8]=(...l)=>e.handleBlur&&e.handleBlur(...l))},null,40,cl),[[z,b.value]])]),t("div",null,[t("img",{src:"/images/login/password_grey.svg"},null,8,ml)])]),g.value?(m(),h("div",vl,[t("p",hl,_(g.value),1)])):E("",!0),x.value?(m(),h("div",fl,[t("p",gl,_(x.value),1)])):E("",!0)]),_:1},8,["validation-schema"])]),_:1},8,["modelValue","title","button-label"]),c(j,{modelValue:H.value,"onUpdate:modelValue":a[10]||(a[10]=l=>H.value=l),title:n(r)("users.modal.delete.title"),button:"bg-main","has-cancel":"",onConfirm:_e},{default:w(()=>[pl]),_:1},8,["modelValue","title"]),$.value.length?(m(),h("div",bl,[(m(!0),h(R,null,G($.value,l=>(m(),h("span",{key:l.id,class:"inline-block px-2 py-1 rounded-sm mr-2 text-sm bg-gray-100 dark:bg-slate-700"},_(l.name),1))),128))])):E("",!0),N.value?(m(),h("div",Nl,[c(n(Ie),{"animation-duration":1e3,"dot-size":15,"dots-num":3,color:"#4BC49A"})])):(m(),h("table",_l,[t("thead",null,[t("tr",null,[(m(!0),h(R,null,G(J.value,l=>(m(),h("th",{key:l.id,onClick:M=>ie(l.id),class:"cursor-pointer"},[U(c(Ge,{path:P.value?n(Re):n(qe),class:"text-gray-600"},null,8,["path"]),[[le,l.id===C.value]]),Me(" "+_(l.label),1)],8,wl))),128)),o.checkable?(m(),h("th",yl)):E("",!0)])]),t("tbody",null,[t("tr",null,[U(t("td",xl,[t("div",kl,[c(n(Ce),{"animation-duration":1e3,size:60,color:"#4BC49A"})])],512),[[le,n(oe)]])]),(m(!0),h(R,null,G(ne.value,(l,M)=>(m(),h("tr",{key:l.id},[t("td",Cl,[c(xe,{type:"justify-start lg:justify-end","no-wrap":""},{default:w(()=>[c(Z,{color:"brandGreen",icon:n(He),small:"",border:"border",borderColor:"brandBorder",onClick:W=>me(l)},null,8,["icon","onClick"]),c(Z,{color:"white",icon:n(Le),small:"",border:"border",borderColor:"brandBorder",onClick:()=>ce(l)},null,8,["icon","onClick"])]),_:2},1024)]),t("td",Bl,[t("small",El,_(n(De)(new Date(l.createdAt),"dd-MM-yyyy HH:mm")),1)]),t("td",Sl,_(l.email),1),t("td",Pl,_(l.username),1),t("td",Al,_(M+1),1),o.checkable?(m(),Te(Be,{key:0,onChecked:a[11]||(a[11]=W=>ue(W,e.client))})):E("",!0)]))),128))])])),c(n(ze),null,{default:w(()=>[c(n(Fe),{modelValue:V.value,"onUpdate:modelValue":a[12]||(a[12]=l=>V.value=l),"total-row":K.value.length,language:"en","page-size-menu":[5,10,20],onChange:de,class:"my-8"},null,8,["modelValue","total-row"])]),_:1})],64))}},Vl={__name:"Header",props:{},emits:["handleClickNewPiece"],setup(o,{emit:s}){const{t:d}=te();return i(!1),(u,f)=>(m(),h("div",null,[c(Z,{label:n(d)("users.create"),labelColor:"text-white",icon:n(je),color:"text-white",bgColor:"!bg-main",border:"border",outline:"",borderColor:"brandBorder",onClick:f[0]||(f[0]=r=>s("handleClickNewPiece"))},null,8,["label","icon"])]))}},zl={__name:"index",setup(o){const s=i(!1),d=i(null),u=()=>{console.log("new piece"),s.value=!0,d.value.showNewModal()};return(f,r)=>(m(),h("div",null,[c(Ee,null,{default:w(()=>[c(Vl,{onHandleClickNewPiece:u}),c(ke,{class:"mb-6 mt-6","has-table":""},{default:w(()=>[c(Ul,{ref_key:"tableCompRef",ref:d},null,512)]),_:1})]),_:1})]))}};export{zl as default};
