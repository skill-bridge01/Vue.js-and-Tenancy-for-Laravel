var be=Object.defineProperty;var _e=(s,l,u)=>l in s?be(s,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[l]=u;var W=(s,l,u)=>(_e(s,typeof l!="symbol"?l+"":l,u),u);import{_ as z,b as q,c as we,d as ye}from"./CardBoxModal-b424615d.js";import{A as xe,_ as ke,a as Ce}from"./SectionMain-62dd47b2.js";import{a2 as M,a3 as Se,r as d,u as le,x as Ee,B as Ne,N as Pe,w as Ae,a5 as Be,a6 as H,a7 as Ue,l as X,o as v,c as m,E as i,z as b,b as t,a1 as Y,a0 as S,a as c,t as f,q as E,F as T,d as j,s as Z,G as ee,e as $e,J as Ve,m as Me,a9 as De,$ as Ie,aa as Te}from"./app-a4a1e86e.js";import{m as Fe,a as Re,b as ze,d as He,f as je}from"./mdi-4b5bd968.js";import{_ as qe}from"./BaseIcon-127a6522.js";class Le{constructor(){W(this,"apiUrl","/users")}create(l,u,n){return M.post(this.apiUrl,{email:l,username:u,password:n})}getList(){return M.get(this.apiUrl+"/")}edit(l,u,n){return M.put(this.apiUrl+"/"+l,{oldPassword:u,password:n})}async updateUser(l,u,n){return(await M.put(this.apiUrl+"/"+l,{oldPassword:u,password:n})).data}delete(l){return M.delete(this.apiUrl+"/"+l)}}const D=new Le,ae=Se("user",{state:()=>({orderedServices:[],selectedService:null,serviceSelected:!1,services:[],fetchError:null,loading:!1}),actions:{clear(){this.orderedServices=[],this.selectedService=null,this.loading=!1},setSelectedService(s){console.log("SelectedUser",s),s?(this.selectedService=s,this.serviceSelected=!0):this.serviceSelected=!1},fetch(){this.loading=!0,D.getList().then(s=>{this.services=s.data}).catch(s=>{this.fetchError=s}).finally(()=>{this.loading=!1})},async create(s,l,u){this.loading=!0;try{const n=await D.create(s,l,u);return n.data.user&&this.services.push(n.data.user),n.data}catch(n){return this.fetchError=n,n}finally{this.loading=!1}},async edit(s,l,u){console.log("eeew",s,l,u),this.loading=!0;try{const n=await D.edit(s,l,u),y=this.services.findIndex(o=>o.id===s);return this.services[y]=n.data,!0}catch(n){return this.fetchError=n,n}finally{this.loading=!1}},async delete(s){this.loading=!0;try{return await D.delete(s),this.services=this.services.filter(l=>l.id!==s),!0}catch(l){return this.fetchError=l,l}finally{this.loading=!1}}}}),Ge={key:0},Oe={class:"text-red-500 text-sm"},Je={key:1},Ke={class:"text-green-400 text-sm"},Qe={class:"flex items-center h-10 bg-white rounded-lg border pr-4 mb-5 mt-10"},We={class:"relative text-gray-600 search-bar mx-3 flex w-full"},Xe=["placeholder","value"],Ye=["src"],Ze={key:0},ea={class:"text-red-500 text-sm"},aa={key:1},la={class:"text-green-400 text-sm"},ta=c("p",null,"Are you sure?",-1),sa={key:0,class:"p-3 bg-gray-100/50 dark:bg-slate-800"},oa={key:1},na=["onClick"],ra={key:0},ia={colspan:"6"},ua={class:"w-full flex justify-center"},ca={class:"before:hidden whitespace-nowrap"},da={"data-label":"Created",class:"whitespace-nowrap"},va={class:"text-gray-500 dark:text-slate-400"},ma={"data-label":"Email"},ha={"data-label":"Name"},fa={"data-label":"PieceId"},pa={key:2,class:"flex justify-center"},ga={__name:"TableDataClient",props:{checkable:Boolean,setModalActive:{type:Boolean,default:!1}},emits:{},setup(s,{expose:l,emit:u}){const n=d(!1);l({showNewModal:()=>{n.value=!0}});const{t:o}=le(),I=d(!1),N=ae(),{services:te,selectedService:U,loading:se}=Ee(ae()),F=d(!1),R=d(5),$=d(1),V=d([]);d(!1);const P=d(!1),x=d(""),p=d(""),k=d(""),_=d(""),h=d(""),A=d(""),B=d(!1),g=d(null),w=d(null);Ne(()=>{N.fetch()}),Pe(()=>{N.clear()});const L=d([{label:o("users.table.actions"),id:"actions"},{label:o("users.table.date"),id:"createdAt"},{label:o("users.table.email"),id:"email"},{label:o("users.table.username"),id:"username"},{label:o("users.table.Number"),id:"id"}]);Ae(()=>{L.value.forEach(e=>{switch(e.id){case"actions":e.label=o("users.table.actions");break;case"createdAt":e.label=o("users.table.date");break;case"email":e.label=o("users.table.email");break;case"username":e.label=o("users.table.username");break;case"id":e.label=o("users.table.Number");break}})});const G=Be().shape({username:H().min(6).required(),password:H().min(8).required(),password_confirmation:H().required().oneOf([Ue("password")],"Passwords do not match")}),O=X(()=>{const e=te.value.map(r=>({createdAt:r.created_at,username:r.username,email:r.email,id:r.id}));return e.sort((r,a)=>r[x.value]>a[x.value]?P.value?1:-1:r[x.value]<a[x.value]?P.value?-1:1:0),e}),oe=X(()=>O.value.slice(R.value*($.value-1),R.value*$.value)),ne=(e,r)=>{const a=[];return e.forEach(C=>{r(C)||a.push(C)}),a},re=(e,r)=>{e?V.value.push(r):V.value=ne(V.value,a=>a.id===r.id)},ie=e=>{x.value===e?P.value=!P.value:(P.value=!0,e!="actions"&&(x.value=e))},ue=e=>{console.log(e),$.value=e.pageNumber,R.value=e.pageSize},ce=e=>{console.log("kk",e.email,e),N.setSelectedService(e),k.value="",h.value="",A.value="",p.value=e.email,I.value=!0},de=e=>{N.setSelectedService(e),F.value=!0},ve=e=>{p.value=e.target.value},me=e=>{_.value=e.target.value},he=e=>{k.value=e.target.value},J=e=>{h.value=e.target.value},K=e=>{A.value=e.target.value},fe=()=>{B.value=!0,console.log("newTitile",p.value,_.value),N.create(p.value,_.value,h.value).then(e=>{e.error?(console.log("errorExcution",e.error,e),B.value=!1,g.value=e.error,document.getElementById("NewForm").reset(),setTimeout(()=>{g.value=null,p.value="",_.value="",h.value=""},500)):e.success&&(p.value="",_.value="",h.value="",document.getElementById("NewForm").reset(),B.value=!1,w.value=e.message,setTimeout(()=>{w.value=null,n.value=!1},500))}).catch(e=>{p.value="",_.value="",h.value="",B.value=!1}).finally(()=>{p.value="",_.value="",h.value="",B.value=!1})},pe=()=>{g.value=null,console.log("ID",U.value.email,U.value.id,k.value,h.value),D.updateUser(U.value.id,k.value,h.value).then(e=>{console.log("Error",e),e.error?(console.log("errorExcution",e.error,e),g.value=e.error,setTimeout(()=>{g.value=null},500)):e.success&&(k.value="",h.value="",A.value="",w.value=e.message,setTimeout(()=>{w.value=null,I.value=!1},500))}).catch(e=>{console.log(e)}).finally(()=>{k.value="",h.value="",A.value=""})},ge=()=>{N.delete(U.value.id).then(e=>{console.log(e)}).catch(e=>{console.log(e)}).finally(()=>{})};return(e,r)=>(v(),m(T,null,[i(z,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=a=>n.value=a),title:"Creat a new user","button-label":t(o)("common.save"),button:"bg-main","has-cancel":"",onConfirm:fe,showModal:!0},{default:b(()=>[i(t(Y),{"validation-schema":t(G),id:"NewForm"},{default:b(()=>[i(S,{"input-type":"email",name:"email",onInput:ve,value:p.value,"icon-src":"/images/login/email_grey.svg",placeholder:t(o)("auth.login.email"),class:"w-full mb-6 font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),i(S,{"input-type":"text",name:"username",onInput:me,value:_.value,"icon-src":"/images/home/placeholder_user.svg",placeholder:t(o)("auth.login.username"),class:"w-full mb-6 font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),i(S,{"input-type":"password",name:"password",onInput:J,value:h.value,"icon-src":"/images/login/password_grey.svg",placeholder:t(o)("auth.login.password"),class:"w-full font-readex text-base font-light mb-6"},null,8,["value","icon-src","placeholder"]),i(S,{"input-type":"password",name:"password_confirmation",onInput:K,value:A.value,"icon-src":"/images/login/password_grey.svg",placeholder:t(o)("auth.signup.confirmPassword"),class:"w-full font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),g.value?(v(),m("div",Ge,[c("p",Oe,f(g.value),1)])):E("",!0),w.value?(v(),m("div",Je,[c("p",Ke,f(w.value),1)])):E("",!0)]),_:1},8,["validation-schema"])]),_:1},8,["modelValue","button-label"]),i(z,{modelValue:I.value,"onUpdate:modelValue":r[2]||(r[2]=a=>I.value=a),title:t(o)("users.modal.edit.title"),button:"bg-main","button-label":t(o)("common.update"),"has-cancel":"",onConfirm:pe,showModal:!0},{default:b(()=>[i(t(Y),{"validation-schema":t(G)},{default:b(()=>{var a;return[c("div",Qe,[c("div",We,[c("input",{class:"text-sm border-none focus:outline-none text-right w-full pr-0",type:"email",name:"email",placeholder:t(o)("account.email"),value:(a=t(U))==null?void 0:a.username,onBlur:r[1]||(r[1]=(...C)=>e.handleBlur&&e.handleBlur(...C)),disabled:""},null,40,Xe)]),c("div",null,[c("img",{src:"/images/login/email_grey.svg"},null,8,Ye)])]),i(S,{"input-type":"password",name:"oldPassword",onInput:he,value:k.value,"icon-src":"/images/login/password_grey.svg",placeholder:t(o)("account.oldPassword"),class:"w-full font-readex text-base font-light mb-6"},null,8,["value","icon-src","placeholder"]),i(S,{"input-type":"password",name:"password",onInput:J,value:h.value,"icon-src":"/images/login/password_grey.svg",placeholder:t(o)("account.newPassword"),class:"w-full font-readex text-base font-light mb-6"},null,8,["value","icon-src","placeholder"]),i(S,{"input-type":"password",name:"password_confirmation",onInput:K,value:A.value,"icon-src":"/images/login/password_grey.svg",placeholder:t(o)("account.confirmPassword"),class:"w-full font-readex text-base font-light"},null,8,["value","icon-src","placeholder"]),g.value?(v(),m("div",Ze,[c("p",ea,f(g.value),1)])):E("",!0),w.value?(v(),m("div",aa,[c("p",la,f(w.value),1)])):E("",!0)]}),_:1},8,["validation-schema"])]),_:1},8,["modelValue","title","button-label"]),i(z,{modelValue:F.value,"onUpdate:modelValue":r[3]||(r[3]=a=>F.value=a),title:t(o)("users.modal.delete.title"),button:"bg-main","has-cancel":"",onConfirm:ge},{default:b(()=>[ta]),_:1},8,["modelValue","title"]),V.value.length?(v(),m("div",sa,[(v(!0),m(T,null,j(V.value,a=>(v(),m("span",{key:a.id,class:"inline-block px-2 py-1 rounded-sm mr-2 text-sm bg-gray-100 dark:bg-slate-700"},f(a.name),1))),128))])):E("",!0),B.value?(v(),m("div",pa,[i(t(De),{"animation-duration":1e3,"dot-size":15,"dots-num":3,color:"#4BC49A"})])):(v(),m("table",oa,[c("thead",null,[c("tr",null,[(v(!0),m(T,null,j(L.value,a=>(v(),m("th",{key:a.id,onClick:C=>ie(a.id),class:"cursor-pointer"},[Z(i(qe,{path:P.value?t(Fe):t(Re),class:"text-gray-600"},null,8,["path"]),[[ee,a.id===x.value]]),$e(" "+f(a.label),1)],8,na))),128)),s.checkable?(v(),m("th",ra)):E("",!0)])]),c("tbody",null,[c("tr",null,[Z(c("td",ia,[c("div",ua,[i(t(xe),{"animation-duration":1e3,size:60,color:"#4BC49A"})])],512),[[ee,t(se)]])]),(v(!0),m(T,null,j(oe.value,(a,C)=>(v(),m("tr",{key:a.id},[c("td",ca,[i(we,{type:"justify-start lg:justify-end","no-wrap":""},{default:b(()=>[i(q,{color:"brandGreen",icon:t(ze),small:"",border:"border",borderColor:"brandBorder",onClick:Q=>de(a)},null,8,["icon","onClick"]),i(q,{color:"white",icon:t(He),small:"",border:"border",borderColor:"brandBorder",onClick:()=>ce(a)},null,8,["icon","onClick"])]),_:2},1024)]),c("td",da,[c("small",va,f(t(Ve)(new Date(a.createdAt),"dd-MM-yyyy HH:mm")),1)]),c("td",ma,f(a.email),1),c("td",ha,f(a.username),1),c("td",fa,f(C+1),1),s.checkable?(v(),Me(ke,{key:0,onChecked:r[4]||(r[4]=Q=>re(Q,e.client))})):E("",!0)]))),128))])])),i(t(Te),null,{default:b(()=>[i(t(Ie),{modelValue:$.value,"onUpdate:modelValue":r[5]||(r[5]=a=>$.value=a),"total-row":O.value.length,language:"en","page-size-menu":[5,10,20],onChange:ue,class:"my-8"},null,8,["modelValue","total-row"])]),_:1})],64))}},ba={__name:"Header",props:{},emits:["handleClickNewPiece"],setup(s,{emit:l}){const{t:u}=le();return d(!1),(n,y)=>(v(),m("div",null,[i(q,{label:t(u)("users.create"),labelColor:"text-white",icon:t(je),color:"text-white",bgColor:"!bg-main",border:"border",outline:"",borderColor:"brandBorder",onClick:y[0]||(y[0]=o=>l("handleClickNewPiece"))},null,8,["label","icon"])]))}},Sa={__name:"index",setup(s){const l=d(!1),u=d(null),n=()=>{console.log("new piece"),l.value=!0,u.value.showNewModal()};return(y,o)=>(v(),m("div",null,[i(Ce,null,{default:b(()=>[i(ba,{onHandleClickNewPiece:n}),i(ye,{class:"mb-6 mt-6","has-table":""},{default:b(()=>[i(ga,{ref_key:"tableCompRef",ref:u},null,512)]),_:1})]),_:1})]))}};export{Sa as default};
